
!/bin/bash

rm ~/x

echo "Installing Termux-am..."
pkg install termux-am -y &>/dev/null

termux-setup-storage & sleep 4 &>/dev/null

while true; do
    if [ -d ~/storage/shared ]; then
        break
    else
        echo "Storage permission denied"
    fi
    sleep 3
done

echo "Installing packages for Termux..."
apt-get clean
apt-get update >/dev/null 2>&1
apt-get -y --with-new-pkgs -o Dpkg::Options::="--force-confdef" upgrade >/dev/null 2>&1
pkg install x11-repo -y &>/dev/null
pkg install pulseaudio -y &>/dev/null
pkg install xwayland -y &>/dev/null
pkg install wget -y &>/dev/null
pkg install tsu -y &>/dev/null
pkg install root-repo -y &>/dev/null
pkg install patchelf -y &>/dev/null
pkg install p7zip -y &>/dev/null
pkg install xorg-xrandr -y &>/dev/null
pkg install ncurses-utils -y &>/dev/null
pkg install hashdeep -y &>/dev/null
pkg install termux-x11-nightly -y &>/dev/null

if [ -e $PREFIX/glibc ]; then
    echo -n "Removing previous glibc. Continue? (Y/n) "
    read i
    if [ "$i" = "Y" ] || [ "$i" = "y" ]; then
        rm -rf $PREFIX/glibc
    else
        return 1
    fi
fi
mkdir -p $HOME/mobox-remake
cd $HOME/mobox-remake
sleep 2
echo "Installing mobox-remake..."
wget -q --show-progress -O mobox-remake-backup-glibc.tar.gz https://github.com/Shephard225/mobox-remake/releases/download/emu-files/mobox-remake-backup-glibc.tar.gz
tar -xf mobox-remake-backup-glibc.tar.gz -C $HOME/mobox-remake

chmod +x $HOME/mobox-remake/glibc/opt/scripts/mobox-remake
ln -sf $HOME/mobox-remake/glibc/opt/scripts/mobox-remake $PREFIX/bin/mobox-remake
rm mobox-remake-backup-glibc.tar.gz

echo -e "\n\e[32m[âœ”] Mobox-Remake installed successfully!\e[0m"
echo -e "To start Mobox-Remake, type: \e[36mmobox-remake\e[0m"
